@rendermode InteractiveServer
@using EasyWoWMacro.Core.Models

<div class="modal @(IsVisible ? "show" : "") conditional-modal" tabindex="-1" style="display: @(IsVisible ? "block" : "none")">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Configure Conditional Group</h5>
                <button type="button" class="btn-close" @onclick="OnClose"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Select Conditions (multiple allowed)</label>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Basic Conditions</h6>
                            @foreach (var condition in basicConditions)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" 
                                           id="@condition" 
                                           checked="@SelectedConditions.Contains(condition)"
                                           @onchange="@(e => HandleConditionChange(condition, e))" />
                                    <label class="form-check-label" for="@condition">
                                        @condition
                                    </label>
                                </div>
                            }
                        </div>
                        <div class="col-md-6">
                            <h6>Advanced Conditions</h6>
                            <small class="text-muted mb-2 d-block">These conditionals require additional configuration</small>
                            @foreach (var condition in advancedConditions)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" 
                                           id="@condition" 
                                           checked="@SelectedConditions.Contains(condition)"
                                           @onchange="@(e => HandleConditionChange(condition, e))" />
                                    <label class="form-check-label" for="@condition">
                                        @condition
                                        @if (condition == "stance:")
                                        {
                                            <small class="text-muted d-block">Check current stance/form (Warrior, Druid, etc.)</small>
                                        }
                                        else if (condition == "equipped:")
                                        {
                                            <small class="text-muted d-block">Check if specific item/slot is equipped</small>
                                        }
                                        else if (condition == "form:")
                                        {
                                            <small class="text-muted d-block">Check current druid form</small>
                                        }
                                        else if (condition == "button:")
                                        {
                                            <small class="text-muted d-block">Check which mouse button was pressed</small>
                                        }
                                        else if (condition == "threat:")
                                        {
                                            <small class="text-muted d-block">Check threat level on target</small>
                                        }
                                        else if (condition == "spec:")
                                        {
                                            <small class="text-muted d-block">Check current specialization</small>
                                        }
                                        else if (condition == "talent:")
                                        {
                                            <small class="text-muted d-block">Check if specific talent is learned</small>
                                        }
                                        else if (condition == "glyph:")
                                        {
                                            <small class="text-muted d-block">Check if specific glyph is active</small>
                                        }
                                        else if (condition == "spell:")
                                        {
                                            <small class="text-muted d-block">Check if specific spell is known</small>
                                        }
                                        else if (condition == "item:")
                                        {
                                            <small class="text-muted d-block">Check if specific item is in bags</small>
                                        }
                                        else if (condition == "aura:")
                                        {
                                            <small class="text-muted d-block">Check if specific aura is active</small>
                                        }
                                        else if (condition == "buff:" || condition == "debuff:")
                                        {
                                            <small class="text-muted d-block">Check if specific buff/debuff is active</small>
                                        }
                                        else if (condition.StartsWith("@"))
                                        {
                                            <small class="text-muted d-block">Target modifier (e.g., @@target, @@mouseover)</small>
                                        }
                                    </label>
                                </div>
                            }
                        </div>
                    </div>
                </div>
                
                @if (SelectedConditions.Contains("mod:") || SelectedConditions.Contains("nomod:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Modifier Key</label>
                        <select class="form-select" @bind="selectedModifier">
                            <option value="">Select modifier...</option>
                            <option value="alt">Alt</option>
                            <option value="ctrl">Ctrl</option>
                            <option value="shift">Shift</option>
                            <option value="alt,ctrl">Alt+Ctrl</option>
                            <option value="alt,shift">Alt+Shift</option>
                            <option value="ctrl,shift">Ctrl+Shift</option>
                            <option value="alt,ctrl,shift">Alt+Ctrl+Shift</option>
                        </select>
                    </div>
                }

                @if (SelectedConditions.Contains("stance:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Stance/Form</label>
                        <select class="form-select" @bind="stanceValue">
                            <option value="">Select stance/form...</option>
                            <optgroup label="Warrior Stances">
                                <option value="1">1 - Battle Stance</option>
                                <option value="2">2 - Defensive Stance</option>
                                <option value="3">3 - Berserker Stance</option>
                            </optgroup>
                            <optgroup label="Druid Forms">
                                <option value="bear">Bear Form</option>
                                <option value="aquatic">Aquatic Form</option>
                                <option value="cat">Cat Form</option>
                                <option value="travel">Travel Form</option>
                                <option value="moonkin">Moonkin Form</option>
                            </optgroup>
                            <optgroup label="Other">
                                <option value="stealth">Stealth (Rogue)</option>
                                <option value="shadowform">Shadowform (Priest)</option>
                            </optgroup>
                        </select>
                    </div>
                }

                @if (SelectedConditions.Contains("equipped:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Equipment Slot/Item</label>
                        <div class="input-group">
                            <select class="form-select" @bind="equippedType">
                                <option value="slot">Equipment Slot</option>
                                <option value="item">Specific Item</option>
                            </select>
                            @if (equippedType == "slot")
                            {
                                <select class="form-select" @bind="equippedSlot">
                                    <option value="">Select slot...</option>
                                    <option value="1">1 - Head</option>
                                    <option value="2">2 - Neck</option>
                                    <option value="3">3 - Shoulder</option>
                                    <option value="4">4 - Shirt</option>
                                    <option value="5">5 - Chest</option>
                                    <option value="6">6 - Waist</option>
                                    <option value="7">7 - Legs</option>
                                    <option value="8">8 - Boots</option>
                                    <option value="9">9 - Wrist</option>
                                    <option value="10">10 - Gloves</option>
                                    <option value="11">11 - Ring 1</option>
                                    <option value="12">12 - Ring 2</option>
                                    <option value="13">13 - Trinket 1</option>
                                    <option value="14">14 - Trinket 2</option>
                                    <option value="15">15 - Back</option>
                                    <option value="16">16 - Main Hand</option>
                                    <option value="17">17 - Off Hand</option>
                                    <option value="18">18 - Ranged</option>
                                    <option value="19">19 - Tabard</option>
                                </select>
                            }
                            else
                            {
                                <input type="text" class="form-control" placeholder="Item name (e.g., 'Sword of Truth')" @bind="equippedItem" />
                            }
                        </div>
                    </div>
                }

                @if (SelectedConditions.Contains("form:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Form Type</label>
                        <select class="form-select" @bind="formValue">
                            <option value="">Select form...</option>
                            <option value="bear">Bear Form</option>
                            <option value="cat">Cat Form</option>
                            <option value="travel">Travel Form</option>
                            <option value="aquatic">Aquatic Form</option>
                            <option value="moonkin">Moonkin Form</option>
                            <option value="tree">Tree of Life Form</option>
                        </select>
                    </div>
                }

                @if (SelectedConditions.Contains("button:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Mouse Button</label>
                        <select class="form-select" @bind="buttonValue">
                            <option value="">Select button...</option>
                            <option value="1">1 - Left Click</option>
                            <option value="2">2 - Right Click</option>
                            <option value="3">3 - Middle Click</option>
                            <option value="4">4 - Button 4</option>
                            <option value="5">5 - Button 5</option>
                        </select>
                    </div>
                }

                @if (SelectedConditions.Contains("threat:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Threat Level</label>
                        <select class="form-select" @bind="threatValue">
                            <option value="">Select threat level...</option>
                            <option value="1">1 - Low</option>
                            <option value="2">2 - Medium</option>
                            <option value="3">3 - High</option>
                        </select>
                    </div>
                }

                @if (SelectedConditions.Contains("spec:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Specialization</label>
                        <input type="text" class="form-control" placeholder="Spec name or number (e.g., 'Fire', '1')" @bind="specValue" />
                    </div>
                }

                @if (SelectedConditions.Contains("talent:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Talent</label>
                        <input type="text" class="form-control" placeholder="Talent name or ID" @bind="talentValue" />
                    </div>
                }

                @if (SelectedConditions.Contains("glyph:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Glyph</label>
                        <input type="text" class="form-control" placeholder="Glyph name" @bind="glyphValue" />
                    </div>
                }

                @if (SelectedConditions.Contains("spell:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Spell</label>
                        <input type="text" class="form-control" placeholder="Spell name" @bind="spellValue" />
                    </div>
                }

                @if (SelectedConditions.Contains("item:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Item</label>
                        <input type="text" class="form-control" placeholder="Item name" @bind="itemValue" />
                    </div>
                }

                @if (SelectedConditions.Contains("aura:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Aura</label>
                        <input type="text" class="form-control" placeholder="Aura/buff/debuff name" @bind="auraValue" />
                    </div>
                }

                @if (SelectedConditions.Contains("buff:") || SelectedConditions.Contains("debuff:"))
                {
                    <div class="mb-3">
                        <label class="form-label">Buff/Debuff</label>
                        <input type="text" class="form-control" placeholder="Buff/debuff name" @bind="buffValue" />
                    </div>
                }

                @if (validationErrors.Count > 0)
                {
                    <div class="alert alert-danger">
                        <h6>Please fix the following errors:</h6>
                        <ul class="mb-0">
                            @foreach (var error in validationErrors)
                            {
                                <li>@error</li>
                            }
                        </ul>
                    </div>
                }
                
                <div class="mb-3">
                    <label class="form-label">Preview</label>
                    <div class="preview-box">
                        @GetConditionalPreview()
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" @onclick="OnClose">Cancel</button>
                <button type="button" class="btn btn-primary" @onclick="HandleSave">Save</button>
            </div>
        </div>
    </div>
</div>

@if (IsVisible)
{
    <div class="modal-backdrop show"></div>
} 